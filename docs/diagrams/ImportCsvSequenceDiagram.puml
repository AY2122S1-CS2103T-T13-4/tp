@startuml
'https://plantuml.com/sequence-diagram

autonumber

participant MainWindow
participant Logic
participant CsvAddressBookImportExport
participant CsvUtil

participant CsvAdaptedPerson
participant Model
participant Person

box UI #Bisque
    participant MainWindow
end box


box Logic #AquaMarine
    participant Logic
end box

box Storage #LightBlue
    participant StorageManager
    participant CsvAddressBookImportExport
    participant CsvAdaptedPerson
end box
box Common #Lavender
    participant CsvUtil
end box


box Model
    participant Model
    participant Person
end box




MainWindow -> Logic: importData()
Logic -> StorageManager: importIntoAddressBook(model)
StorageManager -> CsvAddressBookImportExport: importIntoAddressBook(model)

CsvAddressBookImportExport -> CsvUtil: readCsvFile(filepath)

loop number of  rows in import - 1
    create CsvAdaptedPerson
    CsvUtil -> CsvAdaptedPerson
    activate CsvAdaptedPerson

    CsvAdaptedPerson -> CsvUtil
    deactivate CsvAdaptedPerson

    CsvUtil -> CsvAdaptedPerson: toModelType()

    create Person
    CsvAdaptedPerson -> Person
    activate Person
    Person -> CsvAdaptedPerson
    deactivate Person
    CsvUtil <- CsvAdaptedPerson: valid person
    end

CsvAddressBookImportExport <- CsvUtil: optional(list of valid people)
CsvAddressBookImportExport -> CsvAddressBookImportExport: addImportIntoAddressBook(list, model)

loop Number of valid people
    CsvAddressBookImportExport  -> Model : duplicateIndex()

    CsvAddressBookImportExport <- Model : int of duplicate in list
    alt Import does not has duplicate in current database
        CsvAddressBookImportExport ->  Model: addPerson(person)
    else Import has duplicate in current database
        alt import duplicate has been called
                    CsvAddressBookImportExport ->  Model: updatePerson(index, person)
        end
    end
    end

Logic -> Model: getAddressbook()
Logic -> StorageManager: saveAddressbook(model)
Logic -> StorageManager: getImportStatus()

MainWindow <- Logic: status details

@enduml
